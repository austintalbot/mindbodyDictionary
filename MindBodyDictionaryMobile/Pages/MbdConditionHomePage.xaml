<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:model="clr-namespace:MindBodyDictionaryMobile.Models"
             xmlns:vm="clr-namespace:MindBodyDictionaryMobile.PageModels"
             x:DataType="vm:MbdConditionHomePageModel"
             x:Class="MindBodyDictionaryMobile.Pages.MbdConditionHomePage"
             Title="{Binding Title}">

    <Grid Style="{StaticResource MainPageGrid}" RowDefinitions="*">
        <RefreshView Grid.Row="0"
                     Command="{Binding GetConditionListCommand}"
                     IsRefreshing="{Binding IsRefreshing}"
                     RefreshColor="{StaticResource Primary}">
            <ScrollView Style="{StaticResource ContentScrollView}">
                <VerticalStackLayout Style="{StaticResource MainContentStack}">

                    <Image Style="{StaticResource AppLogoImage}" />
                    <Label Text="{Binding Version}"
                           Style="{StaticResource VersionLabel}" />
                    <SearchBar x:Name="MbdConditionSearchBar"
                               SearchButtonPressed="MbdConditionHomePage_SearchButtonPressed"
                               Style="{StaticResource MbdConditionSearchBar}" />

                    <Button Text="Refresh Conditions"
                            Style="{StaticResource RandomMbdConditionButton}"
                            IsEnabled="{Binding IsInitialized}"
                            Command="{Binding GetConditionListCommand}"/>

                    <CollectionView x:Name="ConditionsList"
                                    ItemsSource="{Binding RandomConditionCollection}"
                                    SelectionMode="Single"
                                    SelectedItem="{Binding SelectedCondition, Mode=TwoWay}"
                                    ItemSizingStrategy="MeasureAllItems"
                                    IsVisible="{Binding IsInitialized}">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Vertical"
                                               ItemSpacing="10"/>
                        </CollectionView.ItemsLayout>
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="model:MbdCondition">
                                <Border MinimumHeightRequest="120"
                                        MaximumHeightRequest="240"
                                        Stroke="{StaticResource MbdConditionCardBorder}"
                                        Background="White"
                                        StrokeThickness="1"
                                        Padding="15">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="12"/>
                                    </Border.StrokeShape>
                                    <Border.Shadow>
                                        <Shadow Brush="Black"
                                                Opacity="0.1"
                                                Radius="10"
                                                Offset="0,2"/>
                                    </Border.Shadow>

                                    <Grid RowDefinitions="Auto,*" ColumnDefinitions="*,Auto">
                                        <!-- Name -->
                                        <Label Grid.Row="0" Grid.Column="0"
                                               Text="{Binding Name}"
                                               FontSize="18"
                                               FontAttributes="Bold"
                                               HorizontalTextAlignment="Center"
                                               VerticalTextAlignment="Center"
                                               TextColor="{StaticResource MbdConditionTextColor}"
                                               Margin="0,0,0,10"/>

                                        <!-- Lock Icon -->
                                        <Image Grid.Row="0" Grid.Column="1"
                                               Source="locked_icon.png"
                                               HeightRequest="24"
                                               WidthRequest="24"
                                               HorizontalOptions="End"
                                               VerticalOptions="Start"
                                               IsVisible="{Binding DisplayLock}" />

                                        <!-- Affirmation -->
                                        <Label Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                               Text="{Binding DisplayedAffirmation}"
                                               FontAttributes="Italic"
                                               FontSize="16"
                                               LineBreakMode="WordWrap"
                                               Style="{StaticResource ParagraphLabel}"
                                               TextColor="Black"
                                               MaxLines="4"
                                               VerticalOptions="Fill"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                        <CollectionView.EmptyView>
                            <VerticalStackLayout VerticalOptions="Center"
                                                 HorizontalOptions="Center"
                                                 Spacing="10">
                                <Label Text="No conditions available"
                                       FontSize="16"
                                       TextColor="{StaticResource Gray600}"
                                       HorizontalOptions="Center"/>
                                <Label Text="Pull to refresh"
                                       FontSize="14"
                                       TextColor="{StaticResource Gray400}"
                                       HorizontalOptions="Center"/>
                            </VerticalStackLayout>
                        </CollectionView.EmptyView>
                    </CollectionView>


                </VerticalStackLayout>
            </ScrollView>
        </RefreshView>
    </Grid>
</ContentPage>
