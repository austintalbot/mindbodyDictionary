<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:model="clr-namespace:MindBodyDictionaryMobile.Models"
             xmlns:vm="clr-namespace:MindBodyDictionaryMobile.PageModels"
             x:DataType="vm:MbdConditionHomePageModel"
             x:Class="MindBodyDictionaryMobile.Pages.MbdConditionHomePage"
             Title="{Binding Title}">

    <Grid Style="{StaticResource MainPageGrid}" RowDefinitions="*">
        <RefreshView Grid.Row="0"
                     Command="{Binding GetConditionListCommand}"
                     IsRefreshing="{Binding IsRefreshing}"
                     RefreshColor="{StaticResource Primary}">
            <ScrollView Style="{StaticResource ContentScrollView}">
                <VerticalStackLayout Style="{StaticResource MainContentStack}">

                    <Image Style="{StaticResource AppLogoImage}" />
                    <Label Text="{Binding Version}"
                           Style="{StaticResource VersionLabel}" />
                    <SearchBar x:Name="MbdConditionSearchBar"
                               SearchButtonPressed="MbdConditionHomePage_SearchButtonPressed"
                               Style="{StaticResource MbdConditionSearchBar}" />

                    <Button Text="Refresh Conditions"
                            Style="{StaticResource RandomMbdConditionButton}"
                            IsEnabled="{Binding IsInitialized}"
                            Command="{Binding GetConditionListCommand}"/>

                    <CollectionView x:Name="ConditionsList"
                                    ItemsSource="{Binding RandomConditionCollection}"
                                    SelectionMode="Single"
                                    SelectedItem="{Binding SelectedCondition, Mode=TwoWay}"
                                    ItemSizingStrategy="MeasureAllItems"
                                    IsVisible="{Binding IsInitialized}">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Vertical"
                                               ItemSpacing="10"/>
                        </CollectionView.ItemsLayout>
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="model:MbdCondition">
                                <Border Style="{StaticResource MbdHomePageConditionCard}">
                                    <Grid RowDefinitions="Auto,*" ColumnDefinitions="*,Auto">
                                        <!-- Name -->
                                        <Label Grid.Row="0" Grid.Column="0"
                                               Text="{Binding Name}"
                                               Style="{StaticResource HomePageConditionNameLabel}"/>

                                        <!-- Lock Icon -->
                                        <Image Grid.Row="0" Grid.Column="1"
                                               Style="{StaticResource HomePageLockImage}"
                                               IsVisible="{Binding DisplayLock}" />

                                        <!-- Affirmation -->
                                        <Label Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                               Text="{Binding DisplayedAffirmation}"
                                               Style="{StaticResource HomePageAffirmationLabel}"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                        <CollectionView.EmptyView>
                            <VerticalStackLayout VerticalOptions="Center"
                                                 HorizontalOptions="Center"
                                                 Spacing="10">
                                <Label Style="{StaticResource EmptyViewTitleLabel}" Text="No conditions available" />
                                <Label Style="{StaticResource EmptyViewSubtitleLabel}" Text="Pull to refresh" />
                            </VerticalStackLayout>
                        </CollectionView.EmptyView>
                    </CollectionView>


                </VerticalStackLayout>
            </ScrollView>
        </RefreshView>
    </Grid>
</ContentPage>
