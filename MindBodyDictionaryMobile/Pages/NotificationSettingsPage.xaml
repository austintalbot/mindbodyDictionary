<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="MindBodyDictionaryMobile.Pages.NotificationSettingsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:MindBodyDictionaryMobile.PageModels"
    Title="Notification Settings"
    x:DataType="vm:NotificationSettingsPageModel">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!--  Header  -->
            <Label Style="{StaticResource NotificationHeaderLabel}" />

            <!--  Support Status  -->
            <Border Style="{StaticResource NotificationInfoBorder}">
                <VerticalStackLayout Spacing="10">
                    <Label Style="{StaticResource NotificationInfoTitleLabel}" Text="Device Status" />
                    <Label
                        AutomationId="StatusMessageLabel"
                        Style="{StaticResource NotificationInfoMessageLabel}"
                        Text="{Binding StatusMessage}" />
                    <Label
                        IsVisible="{Binding LastActionReceived, Converter={StaticResource IsNotNullOrEmptyConverter}}"
                        Style="{StaticResource NotificationInfoLastActionLabel}"
                        Text="{Binding LastActionReceived, StringFormat='Last Action: {0}'}" />
                </VerticalStackLayout>
            </Border>

            <!--  Registration Status  -->
            <Border Style="{StaticResource NotificationInfoBorder}">
                <HorizontalStackLayout Style="{StaticResource NotificationRegistrationStatusLayout}">
                    <Label Style="{StaticResource NotificationRegistrationStatusTitleLabel}" Text="Registration Status:" />
                    <Label
                        Style="{StaticResource NotificationRegistrationStatusValueLabel}"
                        Text="{Binding IsRegistered, Converter={StaticResource BoolToRegisteredTextConverter}}"
                        TextColor="{Binding IsRegistered, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#4CAF50|#F44336'}" />
                </HorizontalStackLayout>
            </Border>

            <!--  Action Buttons  -->
            <VerticalStackLayout Spacing="15">
                <Button
                    AutomationId="RegisterNotificationsButton"
                    BackgroundColor="{StaticResource Primary}"
                    Command="{Binding RegisterDeviceCommand}"
                    IsEnabled="{Binding NotificationsSupported}"
                    Style="{StaticResource NotificationActionButton}"
                    Text="Register for Notifications" />

                <Button
                    AutomationId="DeregisterNotificationsButton"
                    BackgroundColor="{StaticResource Secondary}"
                    Command="{Binding DeregisterDeviceCommand}"
                    IsEnabled="{Binding IsRegistered}"
                    Style="{StaticResource NotificationActionButton}"
                    Text="Deregister from Notifications" />
            </VerticalStackLayout>

            <!--  Information  -->
            <Border Style="{StaticResource NotificationInfoBorder}">
                <VerticalStackLayout Spacing="10">
                    <Label Style="{StaticResource NotificationInfoTitleLabel}" Text="About Push Notifications" />
                    <Label Style="{StaticResource NotificationInfoTextLabel}">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="• Receive updates about your projects and tasks" />
                                <Span Text="&#x0a;• Get reminders for important deadlines" />
                                <Span Text="&#x0a;• Stay informed even when the app is closed" />
                                <Span Text="&#x0a;&#x0a;" />
                                <Span FontAttributes="Bold" Text="Note: " />
                                <Span Text="You can manage notification permissions in your device settings." />
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                </VerticalStackLayout>
            </Border>

            <!--  Loading Indicator  -->
            <ActivityIndicator
                IsRunning="{Binding IsRegistering}"
                IsVisible="{Binding IsRegistering}"
                Style="{StaticResource ImageCacheLoadingIndicator}" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
