<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:pageModels="clr-namespace:MindBodyDictionaryMobile.PageModels"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:DataType="pageModels:UpgradePremiumPageModel">

    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior
            EventName="Appearing"
            Command="{Binding NavigatedCommand}" />
    </ContentPage.Behaviors>

    <Grid RowDefinitions="*,Auto" BackgroundColor="{AppThemeBinding Light={StaticResource LightBackground}, Dark={StaticResource DarkBackground}}">
        <!-- Main Content -->
        <ScrollView Grid.Row="0">
            <VerticalStackLayout Margin="{StaticResource LayoutPadding}"
                                 Spacing="{StaticResource LayoutSpacing}"
                                 VerticalOptions="Fill">

                <!-- Logo -->
                <Image Style="{StaticResource UpgradePremiumPageLogoImage}" />

                <!-- Description -->
                <Label IsVisible="{Binding IsSubscribed, StringFormat='!{0}'}" Style="{StaticResource UpgradePremiumDescriptionLabel}" />

                <!-- Terms -->
                <Label IsVisible="{Binding IsSubscribed, StringFormat='!{0}'}" Style="{StaticResource UpgradePremiumTermsLabel}" />

                <!-- Subscription Buttons -->
                <VerticalStackLayout Spacing="{StaticResource LayoutSpacing}"
                                     Padding="0,20,0,0"
                                     IsVisible="{Binding IsSubscribed, StringFormat='!{0}'}">
                    <Button Text="{Binding IsBusy, Converter={StaticResource BoolToTextConverter}, ConverterParameter='Loading...|Subscribe for $9.99/year'}"
                            Command="{Binding PurchaseCommand}"
                            IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBoolConverter}}"
                            Style="{StaticResource UpgradePremiumPrimaryButton}" />

                    <Button Text="{Binding IsBusy, Converter={StaticResource BoolToTextConverter}, ConverterParameter='Restoring...|Restore Subscription'}"
                            Command="{Binding RestoreCommand}"
                            IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBoolConverter}}"
                            Style="{StaticResource UpgradePremiumRestoreButton}" />
                </VerticalStackLayout>

                <!-- Subscription Active Message -->
                <Border IsVisible="{Binding IsSubscribed}" Style="{StaticResource UpgradePremiumActiveBorder}">
                    <Label Style="{StaticResource UpgradePremiumActiveLabel}" />
                </Border>

                <!-- Legal Links -->
                <VerticalStackLayout Spacing="10" Padding="0,30,0,0">
                    <Button Text="Privacy Policy"
                            Command="{Binding PrivacyCommand}"
                            Style="{StaticResource UpgradePremiumLegalButton}" />

                    <Button Text="Terms of Use"
                            Command="{Binding TermsCommand}"
                            CommandParameter="https://www.mindbodydictionary.com/termsandconditions"
                            Style="{StaticResource UpgradePremiumLegalButton}" />
                </VerticalStackLayout>

                <!-- Debug Billing Information -->
                <BoxView Style="{StaticResource UpgradePremiumDebugDivider}"
                         IsVisible="{Binding IsDebug}" />

                <Label IsVisible="{Binding IsDebug}" Style="{StaticResource UpgradePremiumDebugInfoLabel}" />

                <Border IsVisible="{Binding IsDebug}" Style="{StaticResource UpgradePremiumDebugBorder}">
                    <VerticalStackLayout Spacing="10">
                        <Editor x:Name="DebugInfoEditor"
                                Text="{Binding DebugInfo}"
                                Style="{StaticResource UpgradePremiumDebugEditor}" />

                        <HorizontalStackLayout Spacing="10">
                            <Button Text="ðŸ“‹ Copy"
                                    Command="{Binding CopyDebugInfoCommand}"
                                    HorizontalOptions="Fill"
                                    Style="{StaticResource UpgradePremiumDebugCopyButton}" />

                            <Button Text="ðŸ—‘ï¸ Clear"
                                    Command="{Binding ClearDebugInfoCommand}"
                                    HorizontalOptions="Fill"
                                    Style="{StaticResource UpgradePremiumDebugClearButton}" />
                        </HorizontalStackLayout>

                        <Label Style="{StaticResource UpgradePremiumDebugMessageLabel}" />
                    </VerticalStackLayout>
                </Border>
            </VerticalStackLayout>
        </ScrollView>

        <!-- Loading Indicator -->
        <ActivityIndicator Grid.Row="0"
                           IsRunning="{Binding IsBusy}"
                           IsVisible="{Binding IsBusy}"
                           Color="{StaticResource Primary}" />
    </Grid>
</ContentPage>
