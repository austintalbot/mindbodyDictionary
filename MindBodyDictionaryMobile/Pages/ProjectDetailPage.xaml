<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="MindBodyDictionaryMobile.Pages.ProjectDetailPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:MindBodyDictionaryMobile.Pages.Controls"
    xmlns:fonts="clr-namespace:Fonts"
    xmlns:models="clr-namespace:MindBodyDictionaryMobile.Models"
    xmlns:pageModels="clr-namespace:MindBodyDictionaryMobile.PageModels"
    xmlns:pages="clr-namespace:MindBodyDictionaryMobile.Pages"
    xmlns:sf="clr-namespace:Syncfusion.Maui.Toolkit.TextInputLayout;assembly=Syncfusion.Maui.Toolkit"
    Title="Project"
    x:DataType="pageModels:ProjectDetailPageModel">

    <ContentPage.Resources>
        <DataTemplate x:Key="NormalTagTemplate" x:DataType="models:Tag">
            <Border Style="{StaticResource NormalTagBorderStyle}">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding ToggleTagCommand, Source={RelativeSource AncestorType={x:Type pageModels:ProjectDetailPageModel}}, x:DataType=pageModels:ProjectDetailPageModel}" CommandParameter="{Binding .}" />
                </Border.GestureRecognizers>
                <Label Style="{StaticResource NormalTagLabelStyle}" Text="{Binding Title}" />
            </Border>
        </DataTemplate>

        <DataTemplate x:Key="SelectedTagTemplate" x:DataType="models:Tag">
            <Border Background="{Binding DisplayColor}" Style="{StaticResource SelectedTagBorderStyle}">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding ToggleTagCommand, Source={RelativeSource AncestorType={x:Type pageModels:ProjectDetailPageModel}}, x:DataType=pageModels:ProjectDetailPageModel}" CommandParameter="{Binding .}" />
                </Border.GestureRecognizers>
                <Label Style="{StaticResource SelectedTagLabelStyle}" Text="{Binding Title}" />
            </Border>
        </DataTemplate>

        <controls:ChipDataTemplateSelector
            x:Key="ChipDataTemplateSelector"
            NormalTagTemplate="{StaticResource NormalTagTemplate}"
            SelectedTagTemplate="{StaticResource SelectedTagTemplate}" />
    </ContentPage.Resources>

    <ContentPage.ToolbarItems>
        <ToolbarItem
            Command="{Binding DeleteCommand}"
            IconImageSource="{StaticResource IconDelete}"
            Order="Primary"
            Priority="0"
            SemanticProperties.Description="Delete Project"
            Text="Delete" />
    </ContentPage.ToolbarItems>

    <Grid>
        <ScrollView>
            <VerticalStackLayout Padding="{StaticResource LayoutPadding}" Spacing="{StaticResource LayoutSpacing}">
                <sf:SfTextInputLayout Hint="Name">
                    <Entry SemanticProperties.Description="Name" Text="{Binding Name}" />
                </sf:SfTextInputLayout>

                <sf:SfTextInputLayout Hint="Description">
                    <Entry SemanticProperties.Description="Description" Text="{Binding Description}" />
                </sf:SfTextInputLayout>

                <sf:SfTextInputLayout
                    Hint="Category"
                    SemanticProperties.Description="ComboBox to Select Category"
                    SemanticProperties.Hint="State Collapsed">
                    <Picker
                        ItemsSource="{Binding Categories}"
                        SelectedIndex="{Binding CategoryIndex}"
                        SelectedItem="{Binding Category}"
                        SemanticProperties.Description="Category State Expanded"
                        SemanticProperties.Hint="Select the category for the project" />
                </sf:SfTextInputLayout>

                <Label Style="{StaticResource Title2}" Text="Icon" />
                <CollectionView
                    x:Name="IconsCollectionView"
                    ItemsSource="{Binding Icons}"
                    SelectedItem="{Binding Icon}"
                    Style="{StaticResource ProjectDetailIconCollectionView}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:IconData">
                            <Grid
                                SemanticProperties.Description="{Binding Description}"
                                SemanticProperties.Hint="Icon representing the type of task . Tap to select"
                                Style="{StaticResource ProjectDetailIconGrid}">
                                <Label Style="{StaticResource ProjectDetailIconLabel}" Text="{Binding Icon}" />
                                <BoxView
                                    x:Name="SelectedIndicator"
                                    Grid.Row="1"
                                    Style="{StaticResource ProjectDetailSelectedIconIndicator}" />
                                <VisualStateManager.VisualStateGroups>
                                    <VisualStateGroup x:Name="CommonStates">
                                        <VisualState x:Name="Normal">
                                            <VisualState.Setters>
                                                <Setter Property="BackgroundColor" Value="Transparent" />
                                                <Setter TargetName="SelectedIndicator" Property="BoxView.IsVisible" Value="False" />
                                            </VisualState.Setters>
                                        </VisualState>
                                        <VisualState x:Name="Selected">
                                            <VisualState.Setters>
                                                <Setter Property="BackgroundColor" Value="Transparent" />
                                                <Setter Property="Background" Value="Transparent" />
                                                <Setter TargetName="SelectedIndicator" Property="BoxView.IsVisible" Value="True" />
                                            </VisualState.Setters>
                                        </VisualState>
                                    </VisualStateGroup>
                                </VisualStateManager.VisualStateGroups>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout ItemSpacing="{StaticResource LayoutSpacing}" Orientation="Horizontal" />
                    </CollectionView.ItemsLayout>
                </CollectionView>


                <Label Style="{StaticResource Title2}" Text="Tags" />
                <ScrollView Orientation="Horizontal" Style="{StaticResource ProjectDetailTagsScrollView}">
                    <HorizontalStackLayout
                        BindableLayout.ItemTemplateSelector="{StaticResource ChipDataTemplateSelector}"
                        BindableLayout.ItemsSource="{Binding AllTags}"
                        Spacing="{StaticResource LayoutSpacing}" />
                </ScrollView>

                <Button Command="{Binding SaveCommand}" Style="{StaticResource ProjectDetailSaveButton}" />

                <Grid Style="{StaticResource ProjectDetailTasksHeaderGrid}">
                    <Label
                        Style="{StaticResource Title2}"
                        Text="Tasks"
                        VerticalOptions="Center" />
                    <ImageButton
                        Command="{Binding CleanTasksCommand}"
                        IsVisible="{Binding HasCompletedTasks}"
                        SemanticProperties.Description="Clean up"
                        Source="{StaticResource IconClean}"
                        Style="{StaticResource CleanTasksImageButton}" />
                </Grid>
                <VerticalStackLayout BindableLayout.ItemsSource="{Binding Tasks}" Spacing="{StaticResource LayoutSpacing}">
                    <BindableLayout.ItemTemplate>
                        <DataTemplate x:DataType="models:ProjectTask">
                            <controls:TaskView TaskCompletedCommand="{Binding TaskCompletedCommand, Source={RelativeSource AncestorType={x:Type pageModels:ProjectDetailPageModel}}, x:DataType=pageModels:ProjectDetailPageModel}" />
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </VerticalStackLayout>
            </VerticalStackLayout>
        </ScrollView>

        <controls:AddButton Command="{Binding AddTaskCommand}" SemanticProperties.Description="Add task" />
    </Grid>

</ContentPage>
