<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:model="clr-namespace:MindBodyDictionaryMobile.Models"
             xmlns:vm="clr-namespace:MindBodyDictionaryMobile.PageModels"
             x:DataType="vm:ConditionHomePageModel"
             x:Class="MindBodyDictionaryMobile.Pages.ConditionHomePage"
             Title="{Binding Title}">

    <Grid Style="{StaticResource MainPageGrid}" RowDefinitions="*">
        <RefreshView Grid.Row="0"
                     Command="{Binding GetConditionListCommand}"
                     IsRefreshing="{Binding IsRefreshing}"
                     RefreshColor="{StaticResource Primary}">
            <ScrollView Style="{StaticResource ContentScrollView}">
                <VerticalStackLayout Style="{StaticResource MainContentStack}">

                    <Image Style="{StaticResource AppLogoImage}" />
                    <Label Text="{Binding Version}"
                           Style="{StaticResource VersionLabel}" />
                    <SearchBar x:Name="ConditionSearchBar"
                               SearchButtonPressed="ConditionSearchBar_SearchButtonPressed"
                               Style="{StaticResource AilmentSearchBar}" />

                    <Button Text="Refresh Conditions"
                            Style="{StaticResource RandomConditionButton}"
                            IsEnabled="{Binding IsInitialized}"
                            Command="{Binding GetConditionListCommand}"/>

                    <CollectionView ItemsSource="{Binding RandomConditionCollection}"
                                    SelectionMode="None"
                                    ItemSizingStrategy="MeasureAllItems"
                                    IsVisible="{Binding IsInitialized}">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Vertical"
                                               ItemSpacing="10"/>
                        </CollectionView.ItemsLayout>
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="model:MbdCondition">
                                <Border MinimumHeightRequest="120"
                                        MaximumHeightRequest="240"
                                        Stroke="{StaticResource ConditionCardBorder}"
                                        BackgroundColor="{StaticResource ConditionCardBackground}"
                                        StrokeThickness="1"
                                        Padding="15">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="12"/>
                                    </Border.StrokeShape>
                                    <Border.Shadow>
                                        <Shadow Brush="Black"
                                                Opacity="0.1"
                                                Radius="10"
                                                Offset="0,2"/>
                                    </Border.Shadow>
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="TapGestureRecognizer_HomeConditionTapped"
                                                              CommandParameter="{Binding Id}"/>
                                    </Border.GestureRecognizers>

                                    <Grid RowDefinitions="*,Auto">
                                        <Label Grid.Row="0"
                                               Text="{Binding FirstAffirmation}"
                                               FontAttributes="Italic"
                                               FontSize="18"
                                               LineBreakMode="WordWrap"
                                               Style="{StaticResource ParagraphLabel}"
                                               TextColor="Black"
                                               MaxLines="4"
                                               VerticalOptions="Fill"/>

                                        <Label Grid.Row="1"
                                               Text="{Binding Name}"
                                               FontSize="15"
                                               FontAttributes="Bold"
                                               HorizontalTextAlignment="Center"
                                               TextColor="{StaticResource ConditionTextColor}"
                                               Margin="0,10,0,0"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                        <CollectionView.EmptyView>
                            <VerticalStackLayout VerticalOptions="Center"
                                                 HorizontalOptions="Center"
                                                 Spacing="10">
                                <Label Text="No conditions available"
                                       FontSize="16"
                                       TextColor="{StaticResource Gray600}"
                                       HorizontalOptions="Center"/>
                                <Label Text="Pull to refresh"
                                       FontSize="14"
                                       TextColor="{StaticResource Gray400}"
                                       HorizontalOptions="Center"/>
                            </VerticalStackLayout>
                        </CollectionView.EmptyView>
                    </CollectionView>


                </VerticalStackLayout>
            </ScrollView>
        </RefreshView>
    </Grid>
</ContentPage>
